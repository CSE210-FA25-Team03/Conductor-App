<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Group Dashboard | Conductor</title>
    <link rel="stylesheet" href="/dashboards/style.css" />
</head>
<body>
    <div class="page" data-role="student">
        <header class="top-nav">
            <div class="brand">Conductor <span>App</span></div>
            <div class="nav-actions">
                <div class="profile">
                    <div class="profile-dropdown-container" style="position:relative;">
                        <img id="dashboardProfileImg" src="/assets/logo/user.png" alt="Profile" style="width:44px;height:44px;border-radius:50%;object-fit:cover;cursor:pointer;" />
    <!-- Use style.css for consistent dashboard styling -->
                        <div class="profile-dropdown" id="profileDropdown" style="display:none; position:absolute; top:40px; right:0; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.08); min-width:140px; z-index:10;">
                            <a href="/profile_page/profile.html" style="display:block; padding:10px 16px; color:#222; text-decoration:none;">Profile</a>
                            <a href="#" id="logoutBtn" style="display:block; padding:10px 16px; color:#d00; text-decoration:none;">Log Out</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="dashboard-header">
            <div style="display:flex; align-items:center; justify-content:space-between; width:100%;">
                <h1 style="margin:0;">Teams Dashboard</h1>
                <a href="#" id="backDashboard" class="back-btn">‚Üê Back to Dashboard</a>
            </div>
        </section>

        <section class="teams-grid">
        </section>

    </div>

    <!-- Team Details Modal - moved outside page div -->
    <div id="teamModal" class="team-modal" style="display: none;">
        <div class="team-modal-content">
            <span class="team-modal-close">&times;</span>
            
            <div class="team-modal-header">
                <h2 id="modalTeamName">Team Name</h2>
                <span id="modalTeamStatus" class="badge">Status</span>
            </div>
            
            <div class="team-modal-body">
                <div class="modal-section">
                    <h3>Description</h3>
                    <p id="modalDescription">Team description goes here...</p>
                </div>
                
                <div class="modal-section">
                    <h3>Status Description</h3>
                    <p id="modalStatusDesc">What the team is currently working on...</p>
                </div>
                
                <div class="modal-section">
                    <h3>Progress</h3>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div id="modalProgressBar" class="progress-fill" style="width: 0%;"></div>
                        </div>
                        <span id="modalProgressText" class="progress-text">0%</span>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>Teaching Assistant</h3>
                    <p id="modalTA" class="ta-name">TA Name</p>
                </div>
                
                <div class="modal-section">
                    <h3>Team Members</h3>
                    <ul id="modalMembers" class="members-list">
                        <!-- Members will be populated here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <section class="profile-panel" id="profile-panel" aria-hidden="true">
    <!-- Profile panel removed, navigation now goes to profile page -->

    <script src="script.js"></script>

        <script>
            // Define showTeamInfo function first and make it globally accessible
            function showTeamInfo(team) {
                console.log('showTeamInfo called with team:', team);
                
                // Use actual team data, with defaults for missing fields
                const teamData = {
                    name: team.name || "Unnamed Team",
                    description: team.description || "No description available.",
                    status: team.status || "Needs Review",
                    statusDescription: team.description || "Currently working on team projects and assignments.",
                    progress: team.status === 'On Track' ? 75 : team.status === 'At Risk' ? 45 : 60, // Default progress based on status
                    ta: "Sarah Chen", // Default TA (can be enhanced later)
                    members: (team.members || [])
                        .filter(member => {
                            // Filter out entries that start with "+" (like "+2", "+3") as they're just indicators
                            if (typeof member === 'string' && member.startsWith('+')) {
                                return false;
                            }
                            return true;
                        })
                        .map((member, index) => {
                            // If member is a string (like "AM"), create a simple entry
                            // Otherwise assume it's an object
                            if (typeof member === 'string') {
                                return {
                                    name: member, // Will show initials like "AM"
                                    isLeader: index === 0, // First member is leader
                                    score: 85 + Math.floor(Math.random() * 15) // Random score between 85-100
                                };
                            } else {
                                // If member is already an object with name, isLeader, score
                                return member;
                            }
                        })
                };
                
                try {
                    // Populate modal with data
                    const modalName = document.getElementById('modalTeamName');
                    const modalDesc = document.getElementById('modalDescription');
                    const modalStatusDesc = document.getElementById('modalStatusDesc');
                    const modalTA = document.getElementById('modalTA');
                    
                    if (!modalName || !modalDesc || !modalStatusDesc || !modalTA) {
                        console.error('Modal elements not found');
                        return;
                    }
                    
                    modalName.textContent = teamData.name;
                    modalDesc.textContent = teamData.description;
                    modalStatusDesc.textContent = teamData.statusDescription;
                    modalTA.textContent = teamData.ta;
                    
                    // Set status badge
                    const statusBadge = document.getElementById('modalTeamStatus');
                    if (statusBadge) {
                        statusBadge.textContent = teamData.status;
                        statusBadge.className = `badge ${teamData.status === 'On Track' ? 'success' : teamData.status === 'At Risk' ? 'risk' : ''}`;
                    }
                    
                    // Set progress bar
                    const progressBar = document.getElementById('modalProgressBar');
                    const progressText = document.getElementById('modalProgressText');
                    if (progressBar && progressText) {
                        progressBar.style.width = `${teamData.progress}%`;
                        progressText.textContent = `${teamData.progress}%`;
                    }
                    
                    // Populate members list
                    const membersList = document.getElementById('modalMembers');
                    if (membersList) {
                        membersList.innerHTML = teamData.members.map(member => `
                            <li class="member-item">
                                <span class="member-name">
                                    ${member.name}
                                    ${member.isLeader ? '<span class="leader-badge">üëë Leader</span>' : ''}
                                </span>
                                <span class="member-score">Score: ${member.score}</span>
                            </li>
                        `).join('');
                    }
                    
                    // Show modal
                    const modal = document.getElementById('teamModal');
                    if (modal) {
                        console.log('Showing modal');
                        modal.style.display = 'flex';
                    } else {
                        console.error('Modal element not found');
                    }
                } catch (error) {
                    console.error('Error showing team info:', error);
                }
            }
            
            // Make function globally accessible
            window.showTeamInfo = showTeamInfo;
            
            // Fetch teams from API
            async function loadTeams() {
            try {
                const response = await fetch('/api/teams');
                const teams = await response.json();
                
                const teamsGrid = document.querySelector('.teams-grid');
                teamsGrid.innerHTML = ''; // Clear hardcoded cards
                
                teams.forEach(team => {
                const card = createTeamCard(team);
                teamsGrid.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading teams:', error);
            }
            }
            
            function createTeamCard(team) {
            const card = document.createElement('div');
            card.className = `team-card ${team.status === 'At Risk' ? 'risk' : ''}`;
            
            const statusClass = team.status === 'On Track' ? 'success' : 
                                team.status === 'At Risk' ? 'risk' : '';
            
            card.innerHTML = `
                <header>
                <div>
                    <small>${team.teamNumber}</small>
                    <h3>${team.name}</h3>
                </div>
                <span class="badge ${statusClass}">${team.status}</span>
                </header>
                <p>${team.description}</p>
                <div class="avatar-stack">
                ${team.members.map(m => `<span>${m}</span>`).join('')}
                </div>
                <div class="card-actions">
                <span>${team.nextSync || team.lastUpdate || team.actionRequired || ''}</span>
                <button class="card-info-btn" data-team-id="${team.id}">Card info</button>
                </div>
            `;
            
            // Add event listener to the button - pass the entire team object
            const button = card.querySelector('.card-info-btn');
            if (button) {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('Button clicked for team:', team);
                    showTeamInfo(team); // Pass the entire team object instead of just ID
                });
            } else {
                console.error('Button not found in card');
            }
            
            return card;
            }
            
            // Close modal functionality
            window.addEventListener('DOMContentLoaded', function() {
                const modal = document.getElementById('teamModal');
                const closeBtn = document.querySelector('.team-modal-close');
                
                if (closeBtn && modal) {
                    closeBtn.addEventListener('click', function() {
                        modal.style.display = 'none';
                    });
                }
                
                window.addEventListener('click', function(event) {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
                
                // Close on Escape key
                document.addEventListener('keydown', function(event) {
                    if (event.key === 'Escape' && modal && modal.style.display === 'flex') {
                        modal.style.display = 'none';
                    }
                });
            });

            // Load teams when page loads
            window.addEventListener('DOMContentLoaded', loadTeams);

        </script>
    </section> 
</body>
</html>
