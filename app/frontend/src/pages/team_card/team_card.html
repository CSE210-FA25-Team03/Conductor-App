<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Group Dashboard | Conductor</title>
    <link rel="stylesheet" href="/dashboards/style.css" />
</head>
<body>
    <div class="page" data-role="student">
        <header class="top-nav">
            <div class="brand">Conductor <span>App</span></div>
            <div class="nav-actions">
                <div class="profile">
                    <div class="profile-dropdown-container" style="position:relative;">
                        <img id="dashboardProfileImg" src="/assets/logo/user.png" alt="Profile" style="width:44px;height:44px;border-radius:50%;object-fit:cover;cursor:pointer;" />
    <!-- Use style.css for consistent dashboard styling -->
                        <div class="profile-dropdown" id="profileDropdown" style="display:none; position:absolute; top:40px; right:0; background:#fff; border:1px solid #ddd; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.08); min-width:140px; z-index:10;">
                            <a href="/profile_page/profile.html" style="display:block; padding:10px 16px; color:#222; text-decoration:none;">Profile</a>
                            <a href="#" id="logoutBtn" style="display:block; padding:10px 16px; color:#d00; text-decoration:none;">Log Out</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="dashboard-header">
            <div style="display:flex; align-items:center; justify-content:space-between; width:100%;">
                <h1 style="margin:0;">Teams Dashboard</h1>
                <a href="#" id="backDashboard" class="back-btn">← Back to Dashboard</a>
            </div>
        </section>

        <section class="teams-grid">
        </section>

    </div>

    <section class="profile-panel" id="profile-panel" aria-hidden="true">
    <!-- Profile panel removed, navigation now goes to profile page -->

    <script src="script.js"></script>

        <script>
            // Dropdown logic
            const profileImg = document.getElementById('dashboardProfileImg');
            const dropdown = document.getElementById('profileDropdown');
            profileImg.addEventListener('mouseenter', () => {
                dropdown.style.display = 'block';
            });
            profileImg.addEventListener('mouseleave', () => {
                setTimeout(() => {
                    if (!dropdown.matches(':hover')) dropdown.style.display = 'none';
                }, 150);
            });
            dropdown.addEventListener('mouseleave', () => {
                dropdown.style.display = 'none';
            });
            dropdown.addEventListener('mouseenter', () => {
                dropdown.style.display = 'block';
            });
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                // Clear localStorage and redirect to login
                localStorage.clear();
                window.location.href = '/login';
            });
        </script>

        <script>
            window.addEventListener('DOMContentLoaded', function() {
                var savedImg = localStorage.getItem('profileImg');
                if (savedImg) {
                    var img1 = document.getElementById('dashboardProfileImg');
                    if (img1) img1.src = savedImg;
                    var img2 = document.getElementById('dashboardProfileImgLarge');
                    if (img2) img2.src = savedImg;
                }
            });
        </script>
        <script>
            window.addEventListener('DOMContentLoaded', function() {
                var firstName = localStorage.getItem('firstName') || 'Avery';
                var lastName = localStorage.getItem('lastName') || 'Lin';
                var role = localStorage.getItem('role') || 'Professor';
                var email = localStorage.getItem('email') || 'avery.lin@conductor.edu';
                document.getElementById('profName').textContent = firstName + ' ' + lastName;
                document.getElementById('profFullName').textContent = firstName + ' ' + lastName;
                document.getElementById('profRole').textContent = role + ' · CSE 210';
                document.getElementById('profRoleMeta').textContent = role;
                document.getElementById('profEmail').textContent = email;
            });

        // Dynamic dashboard link based on role
        document.getElementById('backDashboard').addEventListener('click', function(e) {
            e.preventDefault();
            var role = localStorage.getItem('role');
            if (role === 'professor') {
                window.location.href = '/dashboards/professor.html';
            } else {
                window.location.href = '/dashboards/ta.html';
            }
        });
        </script>

        <script>
            // Fetch teams from API
            async function loadTeams() {
            try {
                const response = await fetch('/api/teams');
                const teams = await response.json();
                
                const teamsGrid = document.querySelector('.teams-grid');
                teamsGrid.innerHTML = ''; // Clear hardcoded cards
                
                teams.forEach(team => {
                const card = createTeamCard(team);
                teamsGrid.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading teams:', error);
            }
            }
            
            function createTeamCard(team) {
            const card = document.createElement('div');
            card.className = `team-card ${team.status === 'At Risk' ? 'risk' : ''}`;
            
            const statusClass = team.status === 'On Track' ? 'success' : 
                                team.status === 'At Risk' ? 'risk' : '';
            
            card.innerHTML = `
                <header>
                <div>
                    <small>${team.teamNumber}</small>
                    <h3>${team.name}</h3>
                </div>
                <span class="badge ${statusClass}">${team.status}</span>
                </header>
                <p>${team.description}</p>
                <div class="avatar-stack">
                ${team.members.map(m => `<span>${m}</span>`).join('')}
                </div>
                <div class="card-actions">
                <span>${team.nextSync || team.lastUpdate || team.actionRequired || ''}</span>
                <button onclick="showTeamInfo(${team.id})">Card info</button>
                </div>
            `;
            return card;
            }
            function showTeamInfo(teamId) {
                fetch(`/api/teams/${teamId}`)
                    .then(res => res.json())
                    .then(team => {
                        alert(`Team: ${team.name}\nStatus: ${team.status}\n${team.description}`);
                    })
                    .catch(err => console.error('Error:', err));
            }
            window.addEventListener('DOMContentLoaded', loadTeams);
        </script>
</body>
</html>
